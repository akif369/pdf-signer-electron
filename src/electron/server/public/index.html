<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>PDF Preview</title>
    <script src="/socket.io/socket.io.js"></script>
    <!-- Load PDF.js -->
    <script src="pdfjs/pdf.js"></script>
    <script src="pdfjs/pdf.worker.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 0;
        background: #f8f9fa;
        color: #333;
        /* box-sizing: border-box; */
      }

      #viewer {
        width: 100%;
        /* height: 100vh; */
        overflow: auto;

        display: flex;
        justify-content: center;
        flex-direction: column; /* Stack canvases vertically */
        align-items: center; /* Center horizontally */
        padding: 60px 10px;
      }

      canvas {
        display: block;
        margin: 0 auto 20px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      /* Placeholder UI when no PDF */
      #no-pdf {
        position: absolute;
        top: 50%;
        /* left: 40%; */
        transform: translate(-50%, -50%);
        /* transform: scale(5); */

        text-align: center;
        padding: 30px;
        font-size: 1.5rem;
        color: #555;
        background: #ffffff;
        border-radius: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        animation: float 3s ease-in-out infinite;
      }

      /* Floating animation */
      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-12px);
        }
      }

      /* Animated dots */
      .dots::after {
        content: "";
        animation: dots 1.5s steps(3, end) infinite;
      }

      @keyframes dots {
        0% {
          content: "";
        }
        33% {
          content: ".";
        }
        66% {
          content: "..";
        }
        100% {
          content: "...";
        }
      }
    </style>
  </head>
  <body>
    <div id="viewer">
      <div id="no-pdf">ðŸ“„ No PDF loaded yet<span class="dots"></span></div>
    </div>

    <script>
      const socket = io();

      function loadPdf() {
        fetch("/pdf")
          .then((res) => {
            if (!res.ok) throw new Error("No PDF yet");
            return res.arrayBuffer();
          })
          .then((buffer) => {
            document.getElementById("viewer").innerHTML = ""; // clear old
            const loadingTask = pdfjsLib.getDocument({ data: buffer });
            loadingTask.promise.then((pdf) => {
              for (let i = 1; i <= pdf.numPages; i++) {
                pdf.getPage(i).then((page) => {
                  const viewport = page.getViewport({ scale: 1.5 });
                  const canvas = document.createElement("canvas");
                  const ctx = canvas.getContext("2d");
                  canvas.width = viewport.width;
                  canvas.height = viewport.height;
                  document.getElementById("viewer").appendChild(canvas);
                  page.render({ canvasContext: ctx, viewport });
                });
              }
            });
          })
          .catch(() => {
            document.getElementById("viewer").innerHTML =
              "<div id='no-pdf'>ðŸ“„ No PDF loaded yet<span class='dots'></span></div>";
          });
      }

      // Load once on startup
      loadPdf();

      // Reload when updated
      socket.on("pdf-updated", () => {
        console.log("ðŸ“Œ PDF updated, reloading...");
        loadPdf();
      });
    </script>
  </body>
</html>
